<!DOCTYPE html>
<html>

<head>
	<title>YouTube MP3 Downloader</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background-color: #f5f5f5;
		}

		h1 {
			text-align: center;
			margin-top: 50px;
			color: #333;
		}

		.container {
			width: 50%;
			margin: 50px auto;
			background-color: #fff;
			padding: 20px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			border-radius: 10px;
		}

		label {
			display: block;
			margin-bottom: 10px;
			color: #333;
		}

		input[type="text"] {
			padding: 10px;
			border: 2px solid #ccc;
			border-radius: 4px;
			width: 97%;
		}

		button {
			background-color: #4CAF50;
			color: white;
			padding: 10px 20px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			margin-top: 10px;
		}

		button:hover {
			background-color: #45a049;
		}

		.spinner {
			width: 20px;
			height: 20px;
			border: 2px solid #ccc;
			border-top-color: #666;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			display: none;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}
	</style>
	<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
</head>

<body>
	<h1>YouTube MP3 Downloader</h1>
	<div class="container">
		<form id="download-form">
			<label for="url-input">Enter YouTube URL:</label>
			<input name="url" type="text" id="url-input"
				placeholder="Example: https://www.youtube.com/watch?v=dQw4w9WgXcQ">
			<button type="submit">Download</button>
			<div class="spinner"></div>
		</form>
		<div id="video-details"></div>
		<div id="result"></div>
	</div>
	<script>
		const form = document.getElementById('download-form');
		const resultDiv = document.getElementById('result');
		const spinner = document.getElementsByClassName('spinner')[0];

		form.addEventListener('submit', async (event) => {
			event.preventDefault();
			const urlInput = document.getElementById('url-input');
			const url = urlInput.value.trim();
			spinner.style.display = 'none';
			resultDiv.innerHTML = ""
			if (!url) {
				resultDiv.innerHTML = '<p>Please enter a valid YouTube URL.</p>';
				return;
			}

			// Show the loading spinner
			spinner.style.display = 'inline-block';


			const videoDetailsResponse = await fetch('/info?url=' + encodeURIComponent(url));
			const videoDetails = await videoDetailsResponse.json();
			const videoTitle = videoDetails.title;
			const duration = videoDetails.duration;
			const description = videoDetails.description;

			const videoDetailsDiv = document.getElementById('video-details');
			videoDetailsDiv.innerHTML = '<h3>Video Details</h3>' +
				'<p><strong>Title:</strong> ' + videoTitle + '</p>' +
				'<p><strong>Duration:</strong> ' + duration + '</p>' ;


			// Use a backend API to download the MP3 file and return the download link
			const response = await fetch('/download?url=' + encodeURIComponent(url));
			resultDiv.innerHTML = '<p>Downloading ...</p>';

			// Hide the loading spinner
			spinner.style.display = 'none';
			if (!response.ok) {
				const errorMessage = await response.text();
				resultDiv.innerHTML = '<p>Error: ' + errorMessage + '</p>';
				return;
			}

			const blob = await response.blob();
			const downloadLink = document.createElement('a');
			downloadLink.href = URL.createObjectURL(blob);
			downloadLink.download = url + ".mp3"
			document.body.appendChild(downloadLink);
			downloadLink.click();
			document.body.removeChild(downloadLink);
			resultDiv.innerHTML = '<p>Download is completed</p>';
		});

	</script>
</body>

</html>